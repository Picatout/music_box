C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE MUSIC_BOX
OBJECT MODULE PLACED IN .\src\music_box.OBJ
COMPILER INVOKED BY: c:\SiliconLabs\SimplicityStudio\v4\developer\toolchains\keil_8051\9.53\BIN\C51.exe C:\Users\Jacques
                    -\SimplicityStudio\v4_workspace\music_box\src\music_box.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATF
                    -UZZY(3) OPTIMIZE(9,SPEED) DEFINE(NDEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:\Users\Jacques\SimplicityStudio\v4_work
                    -space\music_box\inc;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.0//Device/shared/si8051base;C:/SiliconLa
                    -bs/SimplicityStudio/v4/developer/sdks/8051/v4.1.0//Device/EFM8BB1/inc) REGFILE(music_box.ORC) PRINT(.\src\music_box.lst)
                    - COND CODE PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\music_box.OBJ)

line level    source

   1          //=========================================================
   2          // src/carrillon_main.c: generated by Hardware Configurator
   3          //
   4          // This file will be updated when saving a document.
   5          // leave the sections inside the "$[...]" comment tags alone
   6          // or they will be overwritten!!
   7          //=========================================================
   8          
   9          //-----------------------------------------------------------------------------
  10          // Includes
  11          //-----------------------------------------------------------------------------
  12          #include <SI_EFM8BB1_Register_Enums.h>                  // SFR declarations
  13          #include "InitDevice.h"
  14          // $[Generated Includes]
  15          // [Generated Includes]$
  16          
  17          //-----------------------------------------------------------------------------
  18          // SiLabs_Startup() Routine
  19          // ----------------------------------------------------------------------------
  20          // This function is called immediately after reset, before the initialization
  21          // code is run in SILABS_STARTUP.A51 (which runs before main() ). This is a
  22          // useful place to disable the watchdog timer, which is enable by default
  23          // and may trigger before main() in some instances.
  24          //-----------------------------------------------------------------------------
  25          void SiLabs_Startup (void)
  26          {
  27   1        // $[SiLabs Startup]
  28   1        // [SiLabs Startup]$
  29   1              CKCON0|=1<<2;
  30   1              TCON|=TCON_TR0__BMASK;
  31   1      
  32   1      }
  33          
  34          #define PAUSE (0)
  35          #define C4 (1)
  36          #define CS4 (2) // dièse
  37          #define DB4 (2) // bémol
  38          #define D4 (3)
  39          #define DS4 (4)
  40          #define EB4 (4)
  41          #define E4 (5)
  42          #define F4 (6)
  43          #define FS4 (7)
  44          #define GB4 (7)
  45          #define G4 (8)
  46          #define GS4 (9)
  47          #define AB4 (9)
  48          #define A4 (10)
  49          #define AS4 (11)
  50          #define BB4 (11)
  51          #define B4 (12)
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 2   

  52          #define C5 (13)
  53          #define CS5 (14)
  54          #define DB5 (14)
  55          #define D5 (15)
  56          #define DS5 (16)
  57          #define EB5 (16)
  58          #define E5 (17)
  59          #define F5 (18)
  60          #define FS5 (19)
  61          #define GB5 (19)
  62          #define G5 (20)
  63          #define GS5 (21)
  64          #define AB5 (21)
  65          #define A5 (22)
  66          #define AS5 (23)
  67          #define BB5 (23)
  68          #define B5 (24)
  69          
  70          // times
  71          #define WHOLE  (64)
  72          #define HALF  (32)
  73          #define QUARTER  (16)
  74          #define HEIGHTH (8)
  75          #define SIXTEENTH (4)
  76          
  77          
  78          unsigned char code scale[25]={
  79                          0,  // PAUSE
  80                          244, // C4
  81                          230, // C#4
  82                          217, // D4
  83                          205, // D#4
  84                          194, // E4
  85                          183, // F4
  86                          172, // F#4
  87                          163, // G4
  88                          154, // G#4
  89                          145, // A4
  90                          137, // A#4
  91                          129, // B4
  92                          122, // C5
  93                          115, // C#5
  94                          109, // D5
  95                          102, // D#5
  96                          97,  // E5
  97                          91,  // F5
  98                          86,  // F#5
  99                          81,  // G5
 100                          77,  // G#5
 101                          73,  //  A5
 102                          68,  // A#5
 103                          65,   // B5
 104          
 105          };
 106          
 107          #define ODE_TEMPO (20)
 108          #define ODE_SCORE (62)
 109          #define ODE_LEN (ODE_SCORE*2+2)
 110          unsigned char code ode_joie[ODE_LEN]={
 111                          ODE_LEN,ODE_TEMPO,
 112                          A4,QUARTER,
 113                          A4,QUARTER,
 114                          AS4,QUARTER,
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 3   

 115                          C5,QUARTER,
 116                          C5,QUARTER,
 117                          AS4,QUARTER,
 118                          A4,QUARTER,
 119                          G4,QUARTER,
 120                          F4,QUARTER,
 121                          F4,QUARTER,
 122                          G4,QUARTER,
 123                          A4,QUARTER,
 124                          A4,QUARTER+HEIGHTH,
 125                          G4,HEIGHTH,
 126                          G4,HALF,
 127                          A4,QUARTER,
 128                          A4,QUARTER,
 129                          AS4,QUARTER,
 130                          C5,QUARTER,
 131                          C5,QUARTER,
 132                          AS4,QUARTER,
 133                          A4,QUARTER,
 134                          G4,QUARTER,
 135                          F4,QUARTER,
 136                          F4,QUARTER,
 137                          G4,QUARTER,
 138                          A4,QUARTER,
 139                          G4,QUARTER+HEIGHTH,
 140                          F4,HEIGHTH,
 141                          F4,HALF,
 142                          G4,QUARTER,
 143                          G4,QUARTER,
 144                          A4,QUARTER,
 145                          F4,QUARTER,
 146                          G4,QUARTER,
 147                          A4,HEIGHTH,
 148                          AS4,HEIGHTH,
 149                          A4,QUARTER,
 150                          F4,QUARTER,
 151                          G4,QUARTER,
 152                          A4,HEIGHTH,
 153                          AS4,HEIGHTH,
 154                          A4,QUARTER,
 155                          G4,QUARTER,
 156                          F4,QUARTER,
 157                          G4,QUARTER,
 158                          C4,HALF,
 159                          A4,QUARTER,
 160                          A4,QUARTER,
 161                          AS4,QUARTER,
 162                          C5,QUARTER,
 163                          C5,QUARTER,
 164                          AS4,QUARTER,
 165                          A4,QUARTER,
 166                          G4,QUARTER,
 167                          F4,QUARTER,
 168                          F4,QUARTER,
 169                          G4,QUARTER,
 170                          A4,QUARTER,
 171                          G4,QUARTER+HEIGHTH,
 172                          F4,HEIGHTH,
 173                          F4,HALF
 174          };
 175          
 176          #define CLAIRE_F_TEMPO (20)
 177          #define CLAIRE_F_SCORE (41)
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 4   

 178          #define CLAIRE_F_LEN (CLAIRE_F_SCORE*2+2)
 179          unsigned char code claire_fontaine[CLAIRE_F_LEN]={
 180             CLAIRE_F_LEN,CLAIRE_F_TEMPO,
 181             // première mesure
 182             G4,HALF,
 183             G4,QUARTER,
 184             B4,QUARTER,
 185             B4,QUARTER,
 186             A4,QUARTER,
 187             B4,QUARTER,
 188             G4,QUARTER,
 189             G4,HALF,
 190             G4,QUARTER,
 191             B4,QUARTER,
 192             B4,QUARTER,
 193             A4,QUARTER,
 194             B4,HALF,
 195             // deuxième mesure
 196             B4,HALF,
 197             B4,QUARTER,
 198             A4,QUARTER,
 199             G4,QUARTER,
 200             B4,QUARTER,
 201             D5,QUARTER,
 202             B4,QUARTER,
 203             D5,HALF,
 204             D5,QUARTER,
 205             B4,QUARTER,
 206             G4,QUARTER,
 207             B4,QUARTER,
 208             A4,HALF,
 209             // troisième mesure
 210             G4,HALF,
 211             G4,QUARTER,
 212             B4,QUARTER,
 213             B4,QUARTER,
 214             A4,HEIGHTH,
 215             G4,HEIGHTH,
 216             B4,QUARTER,
 217             G4,QUARTER,
 218             B4,HALF,
 219             B4,QUARTER,
 220             A4,HEIGHTH,
 221             G4,HEIGHTH,
 222             B4,QUARTER,
 223             A4,QUARTER,
 224             G4,HALF
 225          };
 226          
 227          #define FRERE_J_TEMPO (20)
 228          #define FRERE_J_SCORE (32)
 229          #define FRERE_J_LEN (FRERE_J_SCORE*2+2)
 230          unsigned char code frere_jacques[FRERE_J_LEN]={
 231                          FRERE_J_LEN,FRERE_J_TEMPO,
 232                          F4,QUARTER,
 233                          G4,QUARTER,
 234                          A4,QUARTER,
 235                          F4,QUARTER,
 236                          F4,QUARTER,
 237                          G4,QUARTER,
 238                          A4,QUARTER,
 239                          F4,QUARTER,
 240                          A4,QUARTER,
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 5   

 241                          AS4,QUARTER,
 242                          C5,HALF,
 243                          A4,QUARTER,
 244                          AS4,QUARTER,
 245                          C5,HALF,
 246                          C5,HEIGHTH+SIXTEENTH,
 247                          D5,SIXTEENTH,
 248                          C5,HEIGHTH,
 249                          AS4,HEIGHTH,
 250                          A4,QUARTER,
 251                          F4,QUARTER,
 252                          C5,HEIGHTH+SIXTEENTH,
 253                          D5,SIXTEENTH,
 254                          C5,HEIGHTH,
 255                          AS4,HEIGHTH,
 256                          A4,QUARTER,
 257                          F4,QUARTER,
 258                          F4,QUARTER,
 259                          C4,QUARTER,
 260                          F4,HALF,
 261                          F4,QUARTER,
 262                          C4,QUARTER,
 263                          F4,HALF
 264          };
 265          
 266          #define MELODIA_TEMPO (20)
 267          #define MELODIA_SCORE (43)
 268          #define MELODIA_LEN (MELODIA_SCORE*2+2)
 269          unsigned char code melodia[MELODIA_LEN]={
 270                          MELODIA_LEN,MELODIA_TEMPO,
 271                          A4,QUARTER,
 272                          A4,QUARTER,
 273                          A4,QUARTER,
 274                          A4,QUARTER,
 275                          G4,QUARTER,
 276                          F4,QUARTER,
 277                          F4,QUARTER,
 278                          E4,QUARTER,
 279                          D4,QUARTER,
 280                          D4,QUARTER,
 281                          F4,QUARTER,
 282                          A4,QUARTER,
 283                          D5,QUARTER,
 284                          D5,QUARTER,
 285                          D5,QUARTER,
 286                          D5,QUARTER,
 287                          C5,QUARTER,
 288                          AS4,QUARTER,
 289                          AS4,QUARTER,
 290                          A4,QUARTER,
 291                          G4,QUARTER,
 292                          G4,QUARTER,
 293                          A4,QUARTER,
 294                          AS4,QUARTER,
 295                          A4,QUARTER,
 296                          AS4,QUARTER,
 297                          A4,QUARTER,
 298                          CS5,QUARTER,
 299                          AS4,QUARTER,
 300                          A4,QUARTER,
 301                          A4,QUARTER,
 302                          G4,QUARTER,
 303                          F4,QUARTER,
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 6   

 304                          F4,QUARTER,
 305                          E4,QUARTER,
 306                          D4,QUARTER,
 307                          E4,QUARTER,
 308                          E4,QUARTER,
 309                          E4,QUARTER,
 310                          E4,QUARTER,
 311                          F4,QUARTER,
 312                          E4,QUARTER,
 313                          D4,HALF+QUARTER
 314          };
 315          
 316          #define TABAC_TEMPO (20)
 317          #define TABAC_SCORE (30)
 318          #define TABAC_LEN (TABAC_SCORE*2+2)
 319          
 320          unsigned char code bon_tabac[TABAC_LEN]={
 321                          TABAC_LEN,TABAC_TEMPO,
 322                          G4,QUARTER,
 323                          A4,QUARTER,
 324                          B4,QUARTER,
 325                          G4,QUARTER,
 326                          A4,HALF,
 327                          A4,QUARTER,
 328                          B4,QUARTER,
 329                          C5,HALF,
 330                          C5,HALF,
 331                          B4,HALF,
 332                          B4,HALF,
 333                          G4,QUARTER,
 334                          A4,QUARTER,
 335                          B4,QUARTER,
 336                          G4,QUARTER,
 337                          A4,HALF,
 338                          A4,QUARTER,
 339                          B4,QUARTER,
 340                          C5,HALF,
 341                          D5,HALF,
 342                          G4,WHOLE,
 343                          D5,HALF,
 344                          D5,QUARTER,
 345                          C5,QUARTER,
 346                          B4,HALF,
 347                          A4,QUARTER,
 348                          B4,HALF,
 349                          C5,HALF,
 350                          D5,HALF,
 351                          A4,WHOLE
 352          };
 353          
 354          #define SOURIS_TEMPO (20)
 355          #define SOURIS_SCORE (52)
 356          #define SOURIS_LEN (SOURIS_SCORE*2+2)
 357          char code souris_verte[SOURIS_LEN]={
 358                          SOURIS_LEN,SOURIS_TEMPO,
 359                          G4,HEIGHTH,
 360                          G4,HEIGHTH,
 361                          G4,HEIGHTH,
 362                          A4,HEIGHTH,
 363                          G4,QUARTER,
 364                          D4,QUARTER,
 365                          G4,HEIGHTH,
 366                          G4,HEIGHTH,
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 7   

 367                          G4,HEIGHTH,
 368                          A4,HEIGHTH,
 369                          G4,QUARTER,
 370                          D4,QUARTER,
 371                          C5,HEIGHTH,
 372                          B4,HEIGHTH,
 373                          A4,HEIGHTH,
 374                          B4,HEIGHTH,
 375                          C5,HEIGHTH,
 376                          B4,HEIGHTH,
 377                          A4,QUARTER,
 378                          C5,HEIGHTH,
 379                          B4,HEIGHTH,
 380                          A4,HEIGHTH,
 381                          B4,HEIGHTH,
 382                          C5,HEIGHTH,
 383                          B4,HEIGHTH,
 384                          A4,QUARTER,
 385                          G4,HEIGHTH,
 386                          G4,HEIGHTH,
 387                          G4,HEIGHTH,
 388                          A4,HEIGHTH,
 389                          G4,QUARTER,
 390                          D4,QUARTER,
 391                          G4,HEIGHTH,
 392                          G4,HEIGHTH,
 393                          G4,HEIGHTH,
 394                          A4,HEIGHTH,
 395                          G4,QUARTER,
 396                          D4,QUARTER,
 397                          G4,HEIGHTH,
 398                          G4,HEIGHTH,
 399                          G4,HEIGHTH,
 400                          G4,HEIGHTH,
 401                          A4,QUARTER,
 402                          G4,HEIGHTH,
 403                          G4,HEIGHTH,
 404                          A4,HEIGHTH,
 405                          G4,HEIGHTH,
 406                          G4,HEIGHTH,
 407                          G4,HEIGHTH,
 408                          A4,QUARTER,
 409                          D5,QUARTER,
 410                          G4,WHOLE
 411          };
 412          
 413          #define GOD_SAVE_TEMPO (20)
 414          #define GOD_SAVE_SCORE (41)
 415          #define GOD_SAVE_LEN (GOD_SAVE_SCORE*2+2)
 416          char code god_save[GOD_SAVE_LEN]={
 417                          GOD_SAVE_LEN,GOD_SAVE_TEMPO,
 418                          C5,QUARTER,
 419                          C5,QUARTER,
 420                          D5,QUARTER,
 421                          B4,QUARTER+HEIGHTH,
 422                          C5,HEIGHTH,
 423                          D5,QUARTER,
 424                          E5,QUARTER,
 425                          E5,QUARTER,
 426                          F5,QUARTER,
 427                          E5,QUARTER+HEIGHTH,
 428                          D5,HEIGHTH,
 429                          C5,QUARTER,
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 8   

 430                          D5,QUARTER,
 431                          C5,QUARTER,
 432                          B4,QUARTER,
 433                          C5,HALF+QUARTER,
 434                          G5,QUARTER,
 435                          G5,QUARTER,
 436                          G5,QUARTER,
 437                          G5,QUARTER+HEIGHTH,
 438                          F5,HEIGHTH,
 439                          E5,QUARTER,
 440                          F5,QUARTER,
 441                          F5,QUARTER,
 442                          F5,QUARTER,
 443                          F5,QUARTER+HEIGHTH,
 444                          E5,HEIGHTH,
 445                          D5,QUARTER,
 446                          E5,QUARTER,
 447                          F5,HEIGHTH,
 448                          E5,HEIGHTH,
 449                          D5,HEIGHTH,
 450                          C5,HEIGHTH,
 451                          E5,QUARTER+HEIGHTH,
 452                          F5,HEIGHTH,
 453                          G5,QUARTER,
 454                          A5,HEIGHTH,
 455                          F5,HEIGHTH,
 456                          E5,QUARTER,
 457                          D5,QUARTER,
 458                          C5,HALF+QUARTER
 459          };
 460          
 461          #define BEAU_SAPIN_TEMPO (18)
 462          #define BEAU_SAPIN_SCORE (50)
 463          #define BEAU_SAPIN_LEN (BEAU_SAPIN_SCORE*2+2)
 464          char code beau_sapin[BEAU_SAPIN_LEN]={
 465                          BEAU_SAPIN_LEN,BEAU_SAPIN_TEMPO,
 466                          PAUSE,QUARTER,
 467                          PAUSE,QUARTER,
 468                          D4,QUARTER,
 469                          G4,HEIGHTH+SIXTEENTH,
 470                          G4,SIXTEENTH,
 471                          G4,QUARTER,
 472                          A4,QUARTER,
 473                          B4,HEIGHTH+SIXTEENTH,
 474                          B4,SIXTEENTH,
 475                          B4,QUARTER+HEIGHTH,
 476                          B4,HEIGHTH,
 477                          A4,HEIGHTH,
 478                          B4,HEIGHTH,
 479                          C5,QUARTER,
 480                          FS4,QUARTER,
 481                          A4,QUARTER,
 482                          G4,QUARTER,
 483                          PAUSE,HEIGHTH,
 484                          D5,HEIGHTH,
 485                          D5,HEIGHTH+SIXTEENTH,
 486                          B4,SIXTEENTH,
 487                          E5,QUARTER+HEIGHTH,
 488                          D5,HEIGHTH,
 489                          D5,HEIGHTH+SIXTEENTH,
 490                          C5,SIXTEENTH,
 491                          C5,QUARTER+HEIGHTH,
 492                          C5,HEIGHTH,
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 9   

 493                          C5,HEIGHTH+SIXTEENTH,
 494                          A4,SIXTEENTH,
 495                          D5,QUARTER+HEIGHTH,
 496                          C5,HEIGHTH,
 497                          C5,HEIGHTH+SIXTEENTH,
 498                          B4,SIXTEENTH,
 499                          B4,QUARTER,
 500                          D4,QUARTER,
 501                          G4,HEIGHTH+SIXTEENTH,
 502                          G4,SIXTEENTH,
 503                          G4,QUARTER,
 504                          A4,QUARTER,
 505                          B4,HEIGHTH+SIXTEENTH,
 506                          B4,SIXTEENTH,
 507                          B4,QUARTER+HEIGHTH,
 508                          B4,HEIGHTH,
 509                          A4,HEIGHTH,
 510                          B4,HEIGHTH,
 511                          C5,QUARTER,
 512                          FS4,QUARTER,
 513                          A4,QUARTER,
 514                          G4,QUARTER,
 515                          PAUSE,QUARTER
 516          };
 517          
 518          #define TUNES_COUNT (8)
 519          unsigned char code  *tunes_list[TUNES_COUNT]={
 520                          ode_joie,
 521                          beau_sapin,
 522                          god_save,
 523                          souris_verte,
 524                          bon_tabac,
 525                          claire_fontaine,
 526                          frere_jacques,
 527                          melodia
 528          };
 529          
 530          
 531          
 532          // pause in milliseconds
 533          void pause(unsigned int msec){
 534   1      #define MSEC (65408)
 535   1      
 536   1              TL1=MSEC&0xff;
 537   1              TH1=MSEC>>8;
 538   1              TCON_TF1=0;
 539   1              TCON_TR1=1;
 540   1              while (msec){
 541   2                      while (!TCON_TF1);
 542   2                      msec--;
 543   2                      TL1=MSEC&0xff;
 544   2                      TH1=MSEC>>8;
 545   2                      TCON_TF1=0;
 546   2              }
 547   1              TCON_TR1=0;
 548   1      }
 549          
 550          void tone(unsigned char tone,unsigned int time){
 551   1              PCA0CPH0=scale[tone];
 552   1              P1MDOUT|=P1MDOUT_B1__PUSH_PULL;
 553   1              P1_B1=1;
 554   1              pause(40);
 555   1              P1MDOUT&=~P1MDOUT_B1__PUSH_PULL;
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 10  

 556   1          pause(time);
 557   1      }
 558          
 559          void music_box(unsigned char code *list){
 560   1              unsigned char n,i,length,tempo;
 561   1      
 562   1              length=list[0];
 563   1              tempo=list[1];
 564   1              PCA0CN0|=PCA0CN0_CR__RUN;
 565   1              for (i=2;i<length;i+=2){
 566   2                      n=list[i];
 567   2                      P0|=0x1f;
 568   2                      P0&=~n;
 569   2                      if (!n){
 570   3                              pause(tempo*list[i+1]+40);
 571   3                      }else{
 572   3                              tone(n,tempo*list[i+1]);
 573   3                      }
 574   2              }
 575   1              PCA0CN0&=~PCA0CN0_CR__RUN;
 576   1      }
 577          
 578          #define BTN_DOWN (0)
 579          #define BTN_UP  (1)
 580          // attend que le bouton soie
 581          // dans l'état demandé.
 582          void wait_button(char state){
 583   1              char count;
 584   1              count=0;
 585   1              while (count<10){
 586   2                      pause(1);
 587   2                      if (state==P1_B2){
 588   3                              count++;
 589   3                      }else{
 590   3                              count=0;
 591   3                      }
 592   2              }
 593   1      }
 594          
 595          //-----------------------------------------------------------------------------
 596          // main() Routine
 597          // ----------------------------------------------------------------------------
 598          int main (void)
 599          {
 600   1              unsigned char i,mode, prev;
 601   1        // Call hardware initialization routine
 602   1        enter_DefaultMode_from_RESET();
 603   1      
 604   1        i=0;
 605   1        prev=0;
 606   1        mode=P1_B3;
 607   1        while (1) 
 608   1        {
 609   2          // $[Generated Run-time code]
 610   2          // [Generated Run-time code]$
 611   2                wait_button(BTN_DOWN);
 612   2                if (mode){
 613   3                        do{
 614   4                               // i=random(8)%TUNES_COUNT;
 615   4                                i=TL0%TUNES_COUNT;
 616   4                        }while (i==prev);
 617   3                }else{
 618   3                        i++;
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 11  

 619   3                        i%=TUNES_COUNT;
 620   3                }
 621   2                P0|=0xe0;
 622   2                P0&=~(i<<5);
 623   2                music_box(tunes_list[i]);
 624   2                P0=0xff;
 625   2                prev=i;
 626   2                wait_button(BTN_UP);
 627   2        }                             
 628   1      }
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 12  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com001C (BEGIN)
0000         L?0029:
0000 EB                MOV     A,R3
0001 2401              ADD     A,#01H
0003 FF                MOV     R7,A
0004 E4                CLR     A
0005 33                RLC     A
0006 FE                MOV     R6,A
0007 E500        R     MOV     A,list+01H
0009 2F                ADD     A,R7
000A F582              MOV     DPL,A
000C E500        R     MOV     A,list
000E 3E                ADDC    A,R6
000F F583              MOV     DPH,A
0011 E4                CLR     A
0012 93                MOVC    A,@A+DPTR
0013 FF                MOV     R7,A
0014 E9                MOV     A,R1
0015 8FF0              MOV     B,R7
0017 A4                MUL     AB
0018 22                RET     
             ; FUNCTION Com001C (END)

             ; FUNCTION SiLabs_Startup (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 29
0000 438E04            ORL     CKCON0,#04H
                                           ; SOURCE LINE # 30
0003 438810            ORL     TCON,#010H
                                           ; SOURCE LINE # 32
0006 22                RET     
             ; FUNCTION SiLabs_Startup (END)

             ; FUNCTION _pause (BEGIN)
                                           ; SOURCE LINE # 533
;---- Variable 'msec' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 536
0000 758B80            MOV     TL1,#080H
                                           ; SOURCE LINE # 537
0003 758DFF            MOV     TH1,#0FFH
                                           ; SOURCE LINE # 538
0006 C28F              CLR     TCON_TF1
                                           ; SOURCE LINE # 539
0008 D28E              SETB    TCON_TR1
000A         ?C0002:
                                           ; SOURCE LINE # 540
000A EF                MOV     A,R7
000B 4E                ORL     A,R6
000C 6012              JZ      ?C0003
000E         ?C0004:
                                           ; SOURCE LINE # 541
000E 308FFD            JNB     TCON_TF1,?C0004
0011         ?C0005:
                                           ; SOURCE LINE # 542
0011 EF                MOV     A,R7
0012 1F                DEC     R7
0013 7001              JNZ     ?C0027
0015 1E                DEC     R6
0016         ?C0027:
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 13  

                                           ; SOURCE LINE # 543
0016 758B80            MOV     TL1,#080H
                                           ; SOURCE LINE # 544
0019 758DFF            MOV     TH1,#0FFH
                                           ; SOURCE LINE # 545
001C C28F              CLR     TCON_TF1
                                           ; SOURCE LINE # 546
001E 80EA              SJMP    ?C0002
0020         ?C0003:
                                           ; SOURCE LINE # 547
0020 C28E              CLR     TCON_TR1
                                           ; SOURCE LINE # 548
0022 22                RET     
             ; FUNCTION _pause (END)

             ; FUNCTION _tone (BEGIN)
                                           ; SOURCE LINE # 550
;---- Variable 'time' assigned to Register 'R4/R5' ----
;---- Variable 'tone' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 551
0000 EF                MOV     A,R7
0001 900000      R     MOV     DPTR,#scale
0004 93                MOVC    A,@A+DPTR
0005 F5FC              MOV     PCA0CPH0,A
                                           ; SOURCE LINE # 552
0007 43A502            ORL     P1MDOUT,#02H
                                           ; SOURCE LINE # 553
000A D291              SETB    P1_B1
                                           ; SOURCE LINE # 554
000C 7F28              MOV     R7,#028H
000E 7E00              MOV     R6,#00H
0010 120000      R     LCALL   _pause
                                           ; SOURCE LINE # 555
0013 53A5FD            ANL     P1MDOUT,#0FDH
                                           ; SOURCE LINE # 556
0016 AF05              MOV     R7,AR5
0018 AE04              MOV     R6,AR4
001A 020000      R     LJMP    _pause
             ; FUNCTION _tone (END)

             ; FUNCTION _music_box (BEGIN)
                                           ; SOURCE LINE # 559
0000 8E00        R     MOV     list,R6
0002 8F00        R     MOV     list+01H,R7
                                           ; SOURCE LINE # 562
0004 8F82              MOV     DPL,R7
0006 8E83              MOV     DPH,R6
0008 E4                CLR     A
0009 93                MOVC    A,@A+DPTR
000A F500        R     MOV     length,A
                                           ; SOURCE LINE # 563
000C 7401              MOV     A,#01H
000E 93                MOVC    A,@A+DPTR
;---- Variable 'tempo' assigned to Register 'R1' ----
000F F9                MOV     R1,A
                                           ; SOURCE LINE # 564
0010 43D840            ORL     PCA0CN0,#040H
                                           ; SOURCE LINE # 565
;---- Variable 'i' assigned to Register 'R3' ----
0013 7B02              MOV     R3,#02H
0015         ?C0008:
0015 EB                MOV     A,R3
0016 C3                CLR     C
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 14  

0017 9500        R     SUBB    A,length
0019 5034              JNC     ?C0009
                                           ; SOURCE LINE # 566
001B E500        R     MOV     A,list+01H
001D 2B                ADD     A,R3
001E F582              MOV     DPL,A
0020 E4                CLR     A
0021 3500        R     ADDC    A,list
0023 F583              MOV     DPH,A
0025 E4                CLR     A
0026 93                MOVC    A,@A+DPTR
;---- Variable 'n' assigned to Register 'R2' ----
0027 FA                MOV     R2,A
                                           ; SOURCE LINE # 567
0028 43801F            ORL     P0,#01FH
                                           ; SOURCE LINE # 568
002B F4                CPL     A
002C 5280              ANL     P0,A
                                           ; SOURCE LINE # 569
002E EA                MOV     A,R2
002F 700F              JNZ     ?C0011
                                           ; SOURCE LINE # 570
0031 120000      R     LCALL   L?0029
0034 2428              ADD     A,#028H
0036 FF                MOV     R7,A
0037 E4                CLR     A
0038 35F0              ADDC    A,B
003A FE                MOV     R6,A
003B 120000      R     LCALL   _pause
                                           ; SOURCE LINE # 571
003E 800B              SJMP    ?C0010
0040         ?C0011:
                                           ; SOURCE LINE # 572
0040 120000      R     LCALL   L?0029
0043 FD                MOV     R5,A
0044 ACF0              MOV     R4,B
0046 AF02              MOV     R7,AR2
0048 120000      R     LCALL   _tone
                                           ; SOURCE LINE # 573
                                           ; SOURCE LINE # 574
004B         ?C0010:
004B 0B                INC     R3
004C 0B                INC     R3
004D 80C6              SJMP    ?C0008
004F         ?C0009:
                                           ; SOURCE LINE # 575
004F 53D8BF            ANL     PCA0CN0,#0BFH
                                           ; SOURCE LINE # 576
0052 22                RET     
             ; FUNCTION _music_box (END)

             ; FUNCTION _wait_button (BEGIN)
                                           ; SOURCE LINE # 582
;---- Variable 'state' assigned to Register 'R5' ----
0000 AD07              MOV     R5,AR7
                                           ; SOURCE LINE # 584
;---- Variable 'count' assigned to Register 'R4' ----
0002 E4                CLR     A
0003 FC                MOV     R4,A
0004         ?C0014:
                                           ; SOURCE LINE # 585
0004 C3                CLR     C
0005 EC                MOV     A,R4
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 15  

0006 6480              XRL     A,#080H
0008 948A              SUBB    A,#08AH
000A 5015              JNC     ?C0018
                                           ; SOURCE LINE # 586
000C 7F01              MOV     R7,#01H
000E 7E00              MOV     R6,#00H
0010 120000      R     LCALL   _pause
                                           ; SOURCE LINE # 587
0013 A292              MOV     C,P1_B2
0015 E4                CLR     A
0016 33                RLC     A
0017 B50503            CJNE    A,AR5,?C0016
                                           ; SOURCE LINE # 588
001A 0C                INC     R4
                                           ; SOURCE LINE # 589
001B 80E7              SJMP    ?C0014
001D         ?C0016:
                                           ; SOURCE LINE # 590
001D E4                CLR     A
001E FC                MOV     R4,A
                                           ; SOURCE LINE # 591
                                           ; SOURCE LINE # 592
001F 80E3              SJMP    ?C0014
                                           ; SOURCE LINE # 593
0021         ?C0018:
0021 22                RET     
             ; FUNCTION _wait_button (END)

             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 598
                                           ; SOURCE LINE # 599
                                           ; SOURCE LINE # 602
0000 120000      E     LCALL   enter_DefaultMode_from_RESET
                                           ; SOURCE LINE # 604
0003 E4                CLR     A
0004 F500        R     MOV     i,A
                                           ; SOURCE LINE # 605
;---- Variable 'prev' assigned to Register 'R3' ----
0006 FB                MOV     R3,A
                                           ; SOURCE LINE # 606
0007 A293              MOV     C,P1_B3
0009 33                RLC     A
000A F500        R     MOV     mode,A
000C         ?C0019:
                                           ; SOURCE LINE # 607
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 611
000C E4                CLR     A
000D FF                MOV     R7,A
000E 120000      R     LCALL   _wait_button
                                           ; SOURCE LINE # 612
0011 E500        R     MOV     A,mode
0013 600B              JZ      ?C0021
0015         ?C0024:
                                           ; SOURCE LINE # 613
                                           ; SOURCE LINE # 615
0015 E58A              MOV     A,TL0
0017 5407              ANL     A,#07H
0019 F500        R     MOV     i,A
                                           ; SOURCE LINE # 616
001B 6B                XRL     A,R3
001C 60F7              JZ      ?C0024
                                           ; SOURCE LINE # 617
C51 COMPILER V9.53.0.0   MUSIC_BOX                                                         01/15/2018 16:04:30 PAGE 16  

001E 8005              SJMP    ?C0025
0020         ?C0021:
                                           ; SOURCE LINE # 618
0020 0500        R     INC     i
                                           ; SOURCE LINE # 619
0022 530007      R     ANL     i,#07H
                                           ; SOURCE LINE # 620
0025         ?C0025:
                                           ; SOURCE LINE # 621
0025 4380E0            ORL     P0,#0E0H
                                           ; SOURCE LINE # 622
0028 E500        R     MOV     A,i
002A C4                SWAP    A
002B 33                RLC     A
002C 54E0              ANL     A,#0E0H
002E F4                CPL     A
002F 5280              ANL     P0,A
                                           ; SOURCE LINE # 623
0031 E500        R     MOV     A,i
0033 25E0              ADD     A,ACC
0035 2400        R     ADD     A,#LOW tunes_list
0037 F8                MOV     R0,A
0038 E6                MOV     A,@R0
0039 FE                MOV     R6,A
003A 08                INC     R0
003B E6                MOV     A,@R0
003C FF                MOV     R7,A
003D 120000      R     LCALL   _music_box
                                           ; SOURCE LINE # 624
0040 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 625
0043 AB00        R     MOV     R3,i
                                           ; SOURCE LINE # 626
0045 7F01              MOV     R7,#01H
0047 120000      R     LCALL   _wait_button
                                           ; SOURCE LINE # 627
004A 80C0              SJMP    ?C0019
             ; FUNCTION main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    289    ----
   CONSTANT SIZE    =    743    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
